{% extends 'layouts/base.html' %}

{% block header %}
    <script type=text/javascript src="{{url_for('static', filename='js/edit_db.js')}}"></script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/jquery/latest/jquery.min.js"></script>
{% endblock %}


{% block body %}
    <!-- HOSTS TABLE -->
    <div class="container">
        <p><span class="div-title">List of Hosts</span></p>
        <div class="my-div">
            <form name="edit_host_form" onsubmit="return false">
                <div class="hosts-table">
                    <div class="row">
                        <div class="col header">Hostname</div>
                        <div class="col header">IP</div>
                        <div class="col header">GPU</div>
                        <div class="col header">FPGA</div>
                    </div>

                    <!-- LOOP FOR EACH HOST IN THE DB -->
                    {% for host in hosts %}
                    <hr class="special-hr"/>
                    <div class="row">

                        <!-- LOOP ACROSS EACH ENTRY OF THE HOST -->
                        {% for i in range(0, 4) %}
                            {% if i>1 %}
                                {% if host[i] == 1 %}
                                    <div class="col" name={{ host[0] ~ "_" ~ i }}> Yes </div>
                                {% else %}
                                    <div class="col" name={{ host[0] ~ "_" ~ i }}> No </div>
                                {% endif %}
                            {% else %}
                                <div class="col" name={{ host[0] ~ "_" ~ i }}>{{ host[i] }}</div>
                            {% endif %}
                        {% endfor %}

                        <!-- Edit Host Button -->
                        <div class="col">
                            <button type="submit" class="editBtn" name="btnedit" value={{host[0]}}>Edit</button>
                        </div>

                        <!-- Disable Host Button-->
                        <div class="col">
                            <button type="submit" class="disableBtn" name="btndisable" value={{host[0]}}>Disable</button>
                        </div>

                        <!-- Remove Host Button-->
                        <div class="col">
                            <button type="submit" class="removeBtn" name="btnremove" value={{host[0]}}>Remove</button>
                        </div>
                    </div>
                    {% endfor %}

                    <!-- Script for the buttons of each host -->
                    <script>
                        if (editdb_first_h) {
                            editdb_first_h = false;
                            var hosts = {{ hosts|safe }};

                            // EDIT BUTTONS
                            var edit_buttons = document.getElementsByName("btnedit");
                            for (i = 0; i < edit_buttons.length; i++) {
                                var but_aux_e = edit_buttons[i];
                                but_aux_e.onclick = function () {
                                    editHost(this);
                                };
                            }

                            // DISABLE BUTTONS
                            var disable_buttons = document.getElementsByName("btndisable");
                            for (i = 0; i < disable_buttons.length; i++) {
                                var but_aux_d = disable_buttons[i];
                                var enabled = hosts[i][parseInt(editdb_idx_fpga)+1];
                                // If host is disabled change Color and Text
                                if (enabled == 0) {
                                    but_aux_d.style.background= "#a0c519";
                                    but_aux_d.innerHTML= "Enable";
                                }

                                but_aux_d.onclick = function () {
                                    toggleEnableHost(this.value);
                                };
                            }
                            
                            // REMOVE BUTTONS
                            var remove_buttons = document.getElementsByName("btnremove");
                            for (i = 0; i < remove_buttons.length; i++) {
                                var but_aux_r = remove_buttons[i];                           
                                but_aux_r.onclick = function () {
                                    removeHost(this.value);
                                };
                            }
                        }
                    </script>
                </div>
            </form>
        </div>
    </div>

    <!-- <hr> -->
    <div class="divider div-transparent"></div>


    <!-- ADD NEW HOST -->
    <div class="container">
        <p><span class="div-title">Add New Host</span></p>
        <div class="my-div">
            <form name="new_host_form" action="/new_host" method="post" onsubmit="return verifyNewHost()">
                <div class="form-body host-form">
                    <div class="row">
                        
                        <!-- Hostname -->
                        <div class="col a">
                            <label class="cell-label new-h-label">Hostname:</label>
                            <input type="text" name="hostname" id="hostname" class="form-control" placeholder="Hostname">
                        </div>

                        <!-- IP Address -->
                        <div class="col b">
                            <label class="cell-label new-h-label">IP Addr Ending:</label>
                            <input type="text" name="ipaddr" id="ipaddr" class="form-control" placeholder="XXX">
                        </div>

                        <!-- Has GPU -->
                        <div class="col c">
                            <label class="cell-label new-h-label">With GPU?</label>
                            <select name="hasgpu" id="hasgpu">
                                <option disabled selected value style="display:none"> -- option -- </option>
                                <option value="No">No</option>
                                <option value="Yes">Yes</option>
                            </select>
                        </div>
    
                        <!-- Has FPGA -->
                        <div class="col d">
                            <label class="cell-label new-h-label">With FPGA?</label>
                            <select name="hasfpga" id="hasfpga">
                                <option disabled selected value style="display:none"> -- option -- </option>
                                <option value="No">No</option>
                                <option value="Yes">Yes</option>
                            </select>
                        </div>

                        <!-- Submit Button -->
                        <div class="col e">
                            <button type="submit" id="confirm_host" class="but_res">Confirm</button>
                        </div>
                    </div>            
                </div>
            </form>
        </div>
    </div>
{% endblock %}